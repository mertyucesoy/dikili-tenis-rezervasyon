{% extends 'court/base.html' %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 70vh;">
  <div class="card shadow p-4" style="min-width: 350px; max-width: 500px; width: 100%;">
    <h4 class="text-center mb-3">E-posta Doğrulama</h4>
    <p class="text-center text-muted">Lütfen size gönderilen 6 haneli kodu girin.</p>

    {% if messages %}
      <div class="mt-2">
        {% for message in messages %}
          {% if message.tags == 'error' or message.tags == 'success' %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" id="code-form" class="mt-4">
      {% csrf_token %}
      <div class="d-flex justify-content-between gap-2 mb-4">
        {% for i in "123456" %}
          <input type="text"
                 name="code{{ forloop.counter }}"
                 maxlength="1"
                 class="form-control text-center"
                 style="font-size: 1.5rem; width: 3rem; height: 3.5rem;"
                 inputmode="numeric"
                 pattern="[0-9]*"
                 required>
        {% endfor %}
      </div>

      <input type="hidden" name="code" id="hidden-code">
      <button type="submit" class="btn btn-success w-100">Kodu Doğrula</button>
    </form>
  </div>
</div>

<script>
  // Inputlar otomatik odaklanma + form birleştirme
  const inputs = document.querySelectorAll('input[name^="code"]');
  const hiddenCode = document.getElementById('hidden-code');
  const form = document.getElementById('code-form');

  inputs.forEach((input, idx) => {
    input.addEventListener('input', () => {
      if (input.value.length === 1 && idx < inputs.length - 1) {
        inputs[idx + 1].focus();
      }
    });
  });

  form.addEventListener('submit', function (e) {
    let fullCode = '';
    inputs.forEach(input => fullCode += input.value);
    hiddenCode.value = fullCode;
  });
</script>
{% endblock %}
